{#
    Global variables environment
#}
{% set current_user_session_id = app.session.id %}
{% set current_user_session_sha1 = current_user_session_sha1|sha1 %}
{% set current_route_name = app.request.get('_route') %}
{% block doctype_and_html %}
<!DOCTYPE html>
<html lang="{{ app.request.locale }}">
{% endblock %}
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>{% block title elcodi_config('store.name') %}</title>
        {% block meta_tags "" %}
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script type="text/javascript">document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/,'js');</script>
        <link href="{{ asset('favicon.ico') }}" rel="icon" type="image/vnd.microsoft.icon">
        <link href="{{ asset('favicon.ico') }}" rel="shortcut icon" type="image/x-icon">
        {% block head_style %}{% endblock head_style %}
        {% block head_script %}{% endblock head_script %}
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        {# WARNING: Respond.js doesn't work if you view the page via file:// #}
        <!--[if lt IE 9]>
          <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
          <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script>
            /**
             * Tracker generator for elcodi bamboo store
             */
            var _etc = _etc || [];

            (function() {
                var _etracker = document.createElement('script');
                _etracker.type = 'text/javascript';
                _etracker.async = true;
                _etracker.src = '/bundles/elcodimetric/js/tracker.js';
                var _etracker_s = document.getElementsByTagName('script')[0];
                _etracker_s.parentNode.insertBefore(_etracker, _etracker_s);
            }());
        </script>

        {{ elcodi_hook("store.head_bottom") }}
    </head>

    <body {% block body_id "" %} {% block body_class "" %}>
        {{ elcodi_hook("store.body_top") }}

        <!--[if lt IE 8]>
            <!-- should warn for outdated browser -->
        <![endif]-->
        {% block body "" %}
        {% block pixels "" %}

        <script>

            var isMobile = {
                Android: function() {
                    return navigator.userAgent.match(/Android/i);
                },
                BlackBerry: function() {
                    return navigator.userAgent.match(/BlackBerry/i);
                },
                iOS: function() {
                    return navigator.userAgent.match(/iPhone|iPad|iPod/i);
                },
                Opera: function() {
                    return navigator.userAgent.match(/Opera Mini/i);
                },
                Windows: function() {
                    return navigator.userAgent.match(/IEMobile/i);
                },
                any: function() {
                    return ( isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
                }
            };

            /**
             * Page view beacons
             */
            _etc.push(["{{ store_tracker }}", 'pv', '{{ current_user_session_sha1 }}', '3']);
            _etc.push(["{{ store_tracker }}", 'pv_{{ current_route_name }}', '{{ current_user_session_sha1 }}', '3']);

            /**
             * Specific product view beacon
             */
            {% if current_route_name == 'store_product_view' %}
                _etc.push(["{{ store_tracker }}", 'pv_store_product_view_{{ product.id }}', '{{ current_user_session_sha1 }}', '3']);
            {% endif %}

            /**
             * Specific blog view beacon
             */
            {% if current_route_name == 'store_blog_post_view' %}
                _etc.push(["{{ store_tracker }}", 'pv_store_blog_post_view_{{ blog_post.id }}', '{{ current_user_session_sha1 }}', '3']);
            {% endif %}

            /**
             * Add mobile beacon
             */
            if (isMobile.any()) {
                _etc.push(["{{ store_tracker }}", 'mob', '', '1']);
            } else {
                _etc.push(["{{ store_tracker }}", 'no_mob', '', '1']);
            }

            /**
             * Add search engine beacon
             */
            var referrer = "{{ referrer_domain() }}";
            var referrerIsSearchEngine = {{ referrer_is_search_engine() }};
            if (referrerIsSearchEngine) {
                _etc.push(["{{ store_tracker }}", 'source_se', '', '1']);
                _etc.push(["{{ store_tracker }}", 'rf', referrer, '8'])
            } else if (referrer != false) {
                _etc.push(["{{ store_tracker }}", 'source_ref', '', '1']);
                _etc.push(["{{ store_tracker }}", 'rf', referrer, '8'])
            } else {
                _etc.push(["{{ store_tracker }}", 'source_dir', '', '1'])
            }
        </script>

        {% block foot_script "" %}

        {{ elcodi_hook("store.body_bottom") }}
    </body>
</html>
